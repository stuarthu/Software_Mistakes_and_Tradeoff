## 8.2 数据的分区和切割

我们已经在上一节看过数据本地性这一技术是如何做到让我们可以更轻松地扩展大数据的处理。在真实世界的大数据处理程序中，我们需要存储和处理的数据量往往达到上千TB或PB。我们不可能在一台物理机器上存储这样大量的数据。我们需要一种方法将数据切割存储到N个数据节点上。数据切割的技术有很多，本节将要给大家展示的数据切割技术叫做数据分区。


对于线上处理的数据源（比如数据库），你可以选择某种ID（比如用户ID）作为分区的关键字，并在一台指定节点上存储一段范围内的所有用户。比如说，假设你有1000个用户ID和5个数据节点，第一个节点可以存储0到200的ID，第二个节点存储201到400，以此类推。


在选择分区策略时，你要当心不要引入数据倾斜。数据倾斜指的是大多数的数据都集中在某一个ID上，或着都集中在属于同一节点的一组ID上。比如说，假设我们ID为10的用户贡献了80%的流量并产生了80%的数据。这意味着我们80%的数据都存储在第一个节点，我们的分区策略就不是最优的。在最差情况下，这个用户的数据量可能大到无法存储在一个数据节点上。这里的关键点在于，当我们在线处理数据时，数据分区需要根据读取或写入的模式来进行优化。


### 8.2.1 线下大数据分区
